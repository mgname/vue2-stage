{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observer {\r\n  constructor(data) {\r\n    // Object.defineProperty 只能劫持已经存在的属性，后增的，或者删除的 不知道（vue2为此单独写api：$set、$delete）\r\n    this.walk(data)\r\n  }\r\n  walk(data) {  // 循环对象，对属性依次劫持\r\n    \r\n    // \"重新定义\"属性（性能差）\r\n    Object.keys(data).forEach(key => { defineReactive(data, key, data[key]) })\r\n  }\r\n}\r\n\r\nexport function defineReactive(target, key, value) {  // 属性劫持\r\n\r\n  observe(value)  // 对所有的对象都进行属性劫持\r\n\r\n  Object.defineProperty(target, key, {\r\n    // 内部函数使用外部函数的变量（闭包，value不销毁）\r\n    get() {\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) return\r\n      value = newValue\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(data) {\r\n\r\n  // 对这个对象进行劫持\r\n\r\n  if (typeof data !== 'object' || data === null) {\r\n    return  // 只对对象进行劫持\r\n  }\r\n\r\n  // 如果一个对象被劫持过了，就不需要再被劫持了（要判断一个对象是否被劫持过，可以增添一个实例，用实例来判断是否被劫持过）\r\n  return new Observer(data)\r\n\r\n  \r\n}","import { observe } from \"./observe/index\"\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options  // 获取所有的选项\r\n  // if (opts.props) {\r\n  //   initProps()\r\n  // }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\nfunction proxy(vm, target, key) {\r\n  Object.defineProperty(vm, key, {  // vm.name\r\n    get() {\r\n      return vm[target][key]  // vm._data.name\r\n    },\r\n    set(value) {\r\n      vm[target][key] = value\r\n    }\r\n  })\r\n}\r\nfunction initData(vm) {\r\n  let data = vm.$options.data // data可能是函数和对象\r\n  data = typeof data === 'function' ? data.call(vm) : data\r\n\r\n  vm._data = data\r\n  \r\n  // 对数据进行劫持 vue2 采用了api defineProperty\r\n  observe(data)\r\n\r\n  // 将vue._data 用vm来代理就可以了\r\n  for (const key in data) {\r\n    if (Object.hasOwnProperty.call(data, key)) {\r\n      proxy(vm, '_data', key)\r\n    }\r\n  }\r\n}","import { initState } from \"./state\"\r\n\r\nexport function initMixin(Vue) { // 给Vue增加init方法\r\n  Vue.prototype._init = function (options) { // 用于初始化操作\r\n    \r\n    const vm = this\r\n    // vue vm.$options 就是获取用户的配置\r\n    // 以 $ 开头的都认为是 Vue 自身的属性\r\n    vm.$options = options   // 将用户的选项挂载到实例上\r\n\r\n    // 初始化状态\r\n    initState(vm)\r\n  }  \r\n}","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options = {}) {  // options就是用户的选项\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue)  // 扩展了init方法\r\n\r\nexport default Vue"],"names":["Observer","data","walk","Object","keys","forEach","key","defineReactive","target","value","observe","defineProperty","get","set","newValue","initState","vm","opts","$options","initData","proxy","call","_data","hasOwnProperty","initMixin","Vue","prototype","_init","options"],"mappings":"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"}